(function(e,t,n){function r(n,i){if(!t[n]){if(!e[n]){var s=typeof require=="function"&&require;if(!i&&s)return s(n,!0);throw new Error("Cannot find module '"+n+"'")}var o=t[n]={exports:{}};e[n][0](function(t){var i=e[n][1][t];return r(i?i:t)},o,o.exports)}return t[n].exports}for(var i=0;i<n.length;i++)r(n[i]);return r})({1:[function(require,module,exports){(function(){var Kaliedoscope,canvas,cgl,kk,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Kaliedoscope=function(){function Kaliedoscope(){this.resize=__bind(this.resize,this)}Kaliedoscope.prototype.setupPlane=function(){var i,ids,idt,j,sstep,tcs,_i,_j,_ref,_ref1;this.plane=new CoffeeGL.PlaneHexagonFlat(this.plane_xres,this.plane_yres);idt=0;tcs=[{u:0,v:0},{u:1,v:0},{u:1,v:1}];sstep=[0,1,2];ids=0;for(i=_i=0,_ref=this.plane_yres-1;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i){ids=0;for(j=_j=0,_ref1=this.plane_xres-1;0<=_ref1?_j<=_ref1:_j>=_ref1;j=0<=_ref1?++_j:--_j){this.plane.t[idt++]=tcs[ids].u;this.plane.t[idt++]=tcs[ids].v;ids++;if(ids>2){ids=0}}}return this.plane_base=CoffeeGL.clone(this.plane)};Kaliedoscope.prototype.morphPlane=function(){var dd,dir,dir_dist,falloff,i,idt,inv,j,np,ray2,ray2_prev,tp,_i,_ref,_results;if(!(this.mouse_over&&this.mouse_pressed)){return}idt=0;np=new CoffeeGL.Vec3(0,0,0);tp=new CoffeeGL.Vec2(0,0);ray2=new CoffeeGL.Vec2(this.ray.x,this.ray.y);ray2_prev=new CoffeeGL.Vec2(this.ray_prev.x,this.ray_prev.y);inv=CoffeeGL.Matrix4.invert(this.video_node.matrix);_results=[];for(i=_i=0,_ref=this.plane_yres-1;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i){_results.push(function(){var _j,_ref1,_results1;_results1=[];for(j=_j=0,_ref1=this.plane_xres-1;0<=_ref1?_j<=_ref1:_j>=_ref1;j=0<=_ref1?++_j:--_j){np.x=this.plane.p[idt];np.y=this.plane.p[idt+1];np.z=this.plane.p[idt+2];this.video_node.matrix.multVec(np);tp.x=np.x;tp.y=np.y;dir=CoffeeGL.Vec2.sub(ray2,ray2_prev);dir_dist=ray2.dist(ray2_prev);dd=tp.dist(ray2);dir.normalize();if(dd<this.warp.range){falloff=dd/this.warp.range*this.warp.falloff_factor;tp.add(dir.multScalar(Math.pow(dir_dist,this.warp.exponent)*this.warp.factor*falloff))}np.x=tp.x;np.y=tp.y;inv.multVec(np);this.plane.p[idt++]=np.x;this.plane.p[idt++]=np.y;_results1.push(this.plane.p[idt++]=np.z)}return _results1}.call(this))}return _results};Kaliedoscope.prototype.springBack=function(){var bp,dir,dir_dist,i,idt,j,np,_i,_ref,_results;idt=0;np=new CoffeeGL.Vec3(0,0,0);bp=new CoffeeGL.Vec3(0,0,0);_results=[];for(i=_i=0,_ref=this.plane_yres-1;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i){_results.push(function(){var _j,_ref1,_results1;_results1=[];for(j=_j=0,_ref1=this.plane_xres-1;0<=_ref1?_j<=_ref1:_j>=_ref1;j=0<=_ref1?++_j:--_j){np.x=this.plane.p[idt];np.y=this.plane.p[idt+1];np.z=this.plane.p[idt+2];bp.x=this.plane_base.p[idt];bp.y=this.plane_base.p[idt+1];bp.z=this.plane_base.p[idt+2];dir=CoffeeGL.Vec3.sub(bp,np);dir_dist=bp.dist(np);dir.normalize();dir.multScalar(this.warp.springiness);if(dir_dist>.01){this.plane.p[idt]=np.x+dir.x;this.plane.p[idt+1]=np.y+dir.y;this.plane.p[idt+2]=np.z+dir.z}_results1.push(idt+=3)}return _results1}.call(this))}return _results};Kaliedoscope.prototype.videoNodeTrans=function(w,h){var xfactor,yfactor;if(w==null){w=1}if(h==null){h=1}this.video_node.matrix.identity();this.video_node.matrix.rotate(new CoffeeGL.Vec3(1,0,0),CoffeeGL.PI/2);xfactor=2*w/h;yfactor=2;return this.video_node.matrix.scale(new CoffeeGL.Vec3(xfactor,1,yfactor))};Kaliedoscope.prototype.init=function(){var datg,r0,_this=this;this.plane_yres=9;this.plane_xres=21;this.ray=new CoffeeGL.Vec3(0,0,0);this.ray_prev=new CoffeeGL.Vec3(0,0,0);this.setupPlane();this.video_node=new CoffeeGL.Node(this.plane);this.warp={exponent:2,factor:.6,range:.4,falloff_factor:1,springiness:1e-4};this.video_node.brew({position_buffer_access:GL.DYNAMIC_DRAW,texcoord_buffer_access:GL.DYNAMIC_DRAW});this.videoNodeTrans(CoffeeGL.Context.width,CoffeeGL.Context.height);r0=new CoffeeGL.Request("/basic_texture.glsl");r0.get(function(data){_this.shader=new CoffeeGL.Shader(data);_this.shader.bind();return _this.shader.setUniform3v("uMouseRay",new CoffeeGL.Vec3(0,0,0))});this.camera=new CoffeeGL.Camera.PerspCamera;this.camera.setViewport(CoffeeGL.Context.width,CoffeeGL.Context.height);this.video_node.add(this.camera);this.t=new CoffeeGL.TextureBase({width:240,height:134});GL.enable(GL.CULL_FACE);GL.cullFace(GL.BACK);GL.enable(GL.DEPTH_TEST);this.video_ready=false;this.video_element=document.getElementById("video");this.video_element.preload="auto";this.video_element.src="/background.mp4";this.video_element.oncanplay=function(event){_this.video_element.play();_this.t.update(_this.video_element);_this.video_node.add(_this.t);_this.video_ready=true;return console.log("Video Loaded")};datg=new dat.GUI;datg.remember(this);datg.add(this.warp,"exponent",1,5);datg.add(this.warp,"factor",.001,10);datg.add(this.warp,"range",.01,1);datg.add(this.warp,"falloff_factor",.01,10);datg.add(this.warp,"springiness",1e-5,.01);CoffeeGL.Context.mouseMove.add(this.mouseMoved,this);CoffeeGL.Context.mouseOut.add(this.mouseOut,this);CoffeeGL.Context.mouseOver.add(this.mouseOver,this);CoffeeGL.Context.mouseDown.add(this.mouseDown,this);CoffeeGL.Context.mouseUp.add(this.mouseUp,this);this.mouse_over=false;return this.mouse_pressed=false};Kaliedoscope.prototype.update=function(dt){if(this.video_ready){this.t.update(this.video_element)}if(this.shader!=null){this.shader.setUniform3v("uMouseRay",this.ray)}this.morphPlane();this.video_node.rebrew({position_buffer:0});return this.springBack()};Kaliedoscope.prototype.draw=function(){GL.clearColor(.15,.15,.15,1);GL.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT);return this.video_node.draw()};Kaliedoscope.prototype.resize=function(){CoffeeGL.Context.resizeCanvas(window.innerWidth,window.innerHeight);this.camera.setViewport(CoffeeGL.Context.width,CoffeeGL.Context.height);return this.videoNodeTrans(CoffeeGL.Context.width,CoffeeGL.Context.height)};Kaliedoscope.prototype.mouseMoved=function(event){var x,y;x=event.mouseX;y=event.mouseY;this.ray_prev.copyFrom(this.ray);this.ray=this.camera.castRay(x,y);return this.ray.multScalar(this.camera.pos.z)};Kaliedoscope.prototype.mouseOver=function(event){return this.mouse_over=true};Kaliedoscope.prototype.mouseOut=function(event){return this.mouse_over=false};Kaliedoscope.prototype.mouseDown=function(event){return this.mouse_pressed=true};Kaliedoscope.prototype.mouseUp=function(event){return this.mouse_pressed=false};return Kaliedoscope}();canvas=document.getElementById("webgl-canvas");canvas.width=window.innerWidth;canvas.height=window.innerHeight;kk=new Kaliedoscope;cgl=new CoffeeGL.App("webgl-canvas",kk,kk.init,kk.draw,kk.update);if(typeof window!=="undefined"&&window!==null){window.addEventListener("resize",kk.resize,false)}}).call(this)},{}]},{},[1]);